<% if @show_category_view %>
  <!-- ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ í•„í„° ë·° ìœ ì§€ -->
  <!-- Hero Section -->
  <div class="relative overflow-hidden gradient-bg">
    <div class="absolute inset-0">
      <div class="absolute inset-0 bg-opacity-20"></div>
      <div class="absolute inset-0 bg-gradient-to-r from-purple-800/30 to-blue-800/30"></div>
    </div>
    
    <div class="relative container mx-auto px-4 lg:px-6 py-20 lg:py-32">
      <div class="text-center text-white">
        <h1 class="text-4xl lg:text-6xl font-bold mb-6 leading-tight">
          í”„ë¦¬ë¯¸ì—„ ì»¬ë ‰ì…˜
        </h1>
        <p class="text-xl lg:text-2xl text-white text-opacity-90 mb-8 max-w-3xl mx-auto font-light">
          ì—„ì„ ëœ ìµœê³ ê¸‰ ì œí’ˆë“¤ë¡œ êµ¬ì„±ëœ íŠ¹ë³„í•œ ì»¬ë ‰ì…˜ì„ ë§Œë‚˜ë³´ì„¸ìš”
        </p>
        <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-6">
          <div class="flex items-center space-x-2 text-white text-opacity-80">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span>ì „ ìƒí’ˆ ë¬´ë£Œë°°ì†¡</span>
          </div>
          <div class="flex items-center space-x-2 text-white text-opacity-80">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.031 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
            </svg>
            <span>í’ˆì§ˆë³´ì¦</span>
          </div>
          <div class="flex items-center space-x-2 text-white text-opacity-80">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
            </svg>
            <span>ì•ˆì „ê²°ì œ</span>
          </div>
        </div>
      </div>
    </div>
  </div>
<% else %>
  <!-- ìƒˆë¡œìš´ í™ˆí˜ì´ì§€ ë ˆì´ì•„ì›ƒ -->
  <!-- Hero Slider Section -->
  <div class="relative overflow-hidden h-[500px]" id="hero-slider">
    <!-- ìŠ¬ë¼ì´ë“œ ì»¨í…Œì´ë„ˆ -->
    <div class="absolute inset-0 flex transition-transform duration-700 ease-in-out" id="slider-container">
      
      <!-- ìŠ¬ë¼ì´ë“œ 1 -->
      <div class="w-full flex-shrink-0 relative gradient-bg">
        <div class="absolute inset-0">
          <div class="absolute inset-0 bg-opacity-20"></div>
          <div class="absolute inset-0 bg-gradient-to-r from-purple-800/30 to-blue-800/30"></div>
        </div>
        <div class="relative container mx-auto px-4 lg:px-6 py-16 lg:py-24 h-full flex items-center">
          <div class="text-center text-white w-full">
            <h1 class="text-3xl lg:text-5xl font-bold mb-4 leading-tight">
              LUXE STORE
            </h1>
            <p class="text-lg lg:text-xl text-white text-opacity-90 mb-6 max-w-2xl mx-auto font-light">
              ìµœê³ ì˜ í’ˆì§ˆê³¼ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” í”„ë¦¬ë¯¸ì—„ ì‡¼í•‘ëª°
            </p>
            <button class="bg-white text-purple-600 font-semibold py-3 px-8 rounded-xl hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200">
              ì‡¼í•‘ ì‹œì‘í•˜ê¸°
            </button>
          </div>
        </div>
      </div>

      <!-- ìŠ¬ë¼ì´ë“œ 2 -->
      <div class="w-full flex-shrink-0 relative bg-gradient-to-r from-blue-600 to-indigo-700">
        <div class="absolute inset-0">
          <div class="absolute inset-0 bg-opacity-20"></div>
        </div>
        <div class="relative container mx-auto px-4 lg:px-6 py-16 lg:py-24 h-full flex items-center">
          <div class="text-center text-white w-full">
            <h1 class="text-3xl lg:text-5xl font-bold mb-4 leading-tight">
              ğŸ”¥ íŠ¹ë³„ í• ì¸
            </h1>
            <p class="text-lg lg:text-xl text-white text-opacity-90 mb-6 max-w-2xl mx-auto font-light">
              ì§€ê¸ˆ êµ¬ë§¤í•˜ì‹œë©´ ìµœëŒ€ 30% í• ì¸ í˜œíƒì„ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤
            </p>
            <button class="bg-red-500 text-white font-semibold py-3 px-8 rounded-xl hover:bg-red-600 hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200">
              í• ì¸ ìƒí’ˆ ë³´ê¸°
            </button>
          </div>
        </div>
      </div>

      <!-- ìŠ¬ë¼ì´ë“œ 3 -->
      <div class="w-full flex-shrink-0 relative bg-gradient-to-r from-emerald-600 to-teal-700">
        <div class="absolute inset-0">
          <div class="absolute inset-0 bg-opacity-20"></div>
        </div>
        <div class="relative container mx-auto px-4 lg:px-6 py-16 lg:py-24 h-full flex items-center">
          <div class="text-center text-white w-full">
            <h1 class="text-3xl lg:text-5xl font-bold mb-4 leading-tight">
              ğŸ“± ì‹ ì œí’ˆ ì¶œì‹œ
            </h1>
            <p class="text-lg lg:text-xl text-white text-opacity-90 mb-6 max-w-2xl mx-auto font-light">
              ìµœì‹  ì „ìê¸°ê¸°ì™€ í˜ì‹ ì ì¸ ì œí’ˆë“¤ì„ ë§Œë‚˜ë³´ì„¸ìš”
            </p>
            <button class="bg-white text-emerald-600 font-semibold py-3 px-8 rounded-xl hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200">
              ì‹ ì œí’ˆ ë³´ê¸°
            </button>
          </div>
        </div>
      </div>

      <!-- ìŠ¬ë¼ì´ë“œ 4 -->
      <div class="w-full flex-shrink-0 relative bg-gradient-to-r from-pink-600 to-rose-700">
        <div class="absolute inset-0">
          <div class="absolute inset-0 bg-opacity-20"></div>
        </div>
        <div class="relative container mx-auto px-4 lg:px-6 py-16 lg:py-24 h-full flex items-center">
          <div class="text-center text-white w-full">
            <h1 class="text-3xl lg:text-5xl font-bold mb-4 leading-tight">
              ğŸšš ë¬´ë£Œë°°ì†¡
            </h1>
            <p class="text-lg lg:text-xl text-white text-opacity-90 mb-6 max-w-2xl mx-auto font-light">
              ì „ ìƒí’ˆ ë¬´ë£Œë°°ì†¡ ì„œë¹„ìŠ¤ë¡œ ë”ìš± í¸ë¦¬í•œ ì‡¼í•‘ì„ ê²½í—˜í•˜ì„¸ìš”
            </p>
            <button class="bg-white text-pink-600 font-semibold py-3 px-8 rounded-xl hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200">
              ìì„¸íˆ ë³´ê¸°
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ (ë°ìŠ¤í¬íƒ‘ë§Œ í‘œì‹œ) -->
    <button class="slider-prev-btn hidden md:block" onclick="prevSlide()"></button>
    <button class="slider-next-btn hidden md:block" onclick="nextSlide()"></button>

    <!-- ìŠ¬ë¼ì´ë“œ ì¸ë””ì¼€ì´í„° -->
    <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex space-x-3">
      <button class="w-4 h-4 rounded-full bg-white bg-opacity-60 hover:bg-opacity-90 transition-all duration-300 shadow-lg hover:scale-125 border-2 border-white border-opacity-30" onclick="goToSlide(0)" id="indicator-0"></button>
      <button class="w-4 h-4 rounded-full bg-white bg-opacity-60 hover:bg-opacity-90 transition-all duration-300 shadow-lg hover:scale-125 border-2 border-white border-opacity-30" onclick="goToSlide(1)" id="indicator-1"></button>
      <button class="w-4 h-4 rounded-full bg-white bg-opacity-60 hover:bg-opacity-90 transition-all duration-300 shadow-lg hover:scale-125 border-2 border-white border-opacity-30" onclick="goToSlide(2)" id="indicator-2"></button>
      <button class="w-4 h-4 rounded-full bg-white bg-opacity-60 hover:bg-opacity-90 transition-all duration-300 shadow-lg hover:scale-125 border-2 border-white border-opacity-30" onclick="goToSlide(3)" id="indicator-3"></button>
    </div>
  </div>
<% end %>

<% if @show_category_view %>
  <!-- ê¸°ì¡´ ë©”ì¸ ì½˜í…ì¸  (ì¹´í…Œê³ ë¦¬ í•„í„° ë·°) -->
  <!-- Main Content -->
  <div class="container mx-auto px-4 lg:px-6 py-16">
  
  <!-- ë¸Œë ˆë“œí¬ëŸ¼ ë„¤ë¹„ê²Œì´ì…˜ -->
  <% if @current_category.present? || @current_subcategory.present? || @current_detail.present? %>
    <div class="mb-6">
      <nav class="text-sm">
        <ol class="list-none p-0 inline-flex items-center">
          <li class="flex items-center">
            <%= link_to root_path, class: "text-gray-500 hover:text-purple-600" do %>í™ˆ<% end %>
            <svg class="w-4 h-4 mx-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
            </svg>
          </li>
          <% if @current_category.present? %>
            <li class="flex items-center">
              <%= link_to products_path(category: @current_category), class: "text-gray-500 hover:text-purple-600" do %>
                <%= @current_category %>
              <% end %>
              <% if @current_subcategory.present? %>
                <svg class="w-4 h-4 mx-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                </svg>
              <% end %>
            </li>
          <% end %>
          <% if @current_subcategory.present? %>
            <li class="flex items-center">
              <%= link_to products_path(category: @current_category, subcategory: @current_subcategory), class: "text-gray-500 hover:text-purple-600" do %>
                <%= @current_subcategory %>
              <% end %>
              <% if @current_detail.present? %>
                <svg class="w-4 h-4 mx-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                </svg>
              <% end %>
            </li>
          <% end %>
          <% if @current_detail.present? %>
            <li class="flex items-center">
              <span class="text-purple-600 font-medium"><%= @current_detail %></span>
            </li>
          <% end %>
        </ol>
      </nav>
    </div>
  <% end %>

  <!-- Category Filter -->
  <div class="mb-12">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-6 lg:space-y-0">
      <div>
        <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 mb-2">
          <% if @current_detail.present? %>
            <%= @current_detail %> ìƒí’ˆ
          <% elsif @current_subcategory.present? %>
            <%= @current_subcategory %> ìƒí’ˆ
          <% elsif @current_category.present? %>
            <%= @current_category %> ìƒí’ˆ
          <% else %>
            ì „ì²´ ìƒí’ˆ
          <% end %>
        </h2>
        <p class="text-gray-600">
          <% if @current_category.present? %>
            <%= @current_category %>
            <% if @current_subcategory.present? %> > <%= @current_subcategory %><% end %>
            <% if @current_detail.present? %> > <%= @current_detail %><% end %>
            ì¹´í…Œê³ ë¦¬ì˜ ìƒí’ˆë“¤ì…ë‹ˆë‹¤
          <% else %>
            ìµœê³  í’ˆì§ˆì˜ ì—„ì„ ëœ ì œí’ˆë“¤ì„ ë§Œë‚˜ë³´ì„¸ìš”
          <% end %>
        </p>
      </div>
      
      <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-4 sm:space-y-0 sm:space-x-4">
        <%= form_with local: true, class: "flex items-center space-x-3", id: "category-filter-form" do |form| %>
          <%= form.select :category, options_for_select([
            ['ì „ì²´ ì¹´í…Œê³ ë¦¬', ''],
            ['ğŸ’» ì „ìê¸°ê¸°', 'ì „ìê¸°ê¸°'],
            ['ğŸ‘” ì˜ë¥˜', 'ì˜ë¥˜'],  
            ['ğŸ“š ë„ì„œ', 'ë„ì„œ'],
            ['ğŸ  ìƒí™œìš©í’ˆ', 'ìƒí™œìš©í’ˆ']
          ], params[:category]), {}, { 
            class: "bg-white border-2 border-gray-200 rounded-xl px-4 py-3 text-gray-700 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-colors duration-200 min-w-[180px]",
            id: "category-select",
            onchange: "filterByCategory(this.value)"
          } %>
          <%= form.submit "í•„í„° ì ìš©", class: "gradient-bg text-white font-semibold py-3 px-6 rounded-xl hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200", id: "filter-submit" %>
        <% end %>
        
        <div class="flex items-center space-x-2 text-sm text-gray-500 flex-wrap gap-2">
          <span id="product-count">ì´ <%= @products.count %>ê°œ ìƒí’ˆ</span>
          <% if @current_category.present? %>
            <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-xs font-semibold">
              <%= @current_category %>
            </span>
          <% end %>
          <% if @current_subcategory.present? %>
            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-semibold">
              <%= @current_subcategory %>
            </span>
          <% end %>
          <% if @current_detail.present? %>
            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-semibold">
              <%= @current_detail %>
            </span>
          <% end %>
        </div>
      </div>
    </div>
    
    <!-- ì„œë¸Œì¹´í…Œê³ ë¦¬ í•„í„° (ì¹´í…Œê³ ë¦¬ê°€ ì„ íƒëœ ê²½ìš°ë§Œ í‘œì‹œ) -->
    <% if @current_category.present? %>
      <div class="mt-8" id="category-filters-anchor">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">ì„¸ë¶€ ì¹´í…Œê³ ë¦¬</h3>
        <div class="flex flex-wrap gap-3" id="subcategory-filters">
          <%= link_to products_path(category: @current_category), 
                      class: "subcategory-link px-4 py-2 rounded-xl transition-all duration-200 #{'bg-purple-600 text-white' unless @current_subcategory.present?} #{'bg-gray-100 text-gray-700 hover:bg-purple-100 hover:text-purple-700' if @current_subcategory.present?}" do %>
            ì „ì²´
          <% end %>
          
          <% case @current_category
             when 'ì „ìê¸°ê¸°'
               subcategories = ['íœ´ëŒ€í°', 'PC/íƒœë¸”ë¦¿', 'ì›¨ì–´ëŸ¬ë¸”', 'ì˜¤ë””ì˜¤', 'ê°€ì „ì œí’ˆ']
             when 'ì˜ë¥˜'
               subcategories = ['ë‚¨ì„±', 'ì—¬ì„±', 'í‚¤ì¦ˆ', 'ìƒì˜', 'ì•„ìš°í„°', 'ì¡í™”']
             when 'ë„ì„œ'
               subcategories = ['ì†Œì„¤', 'ìê¸°ê³„ë°œ', 'ì „ë¬¸ì„œì ', 'ë§Œí™”']
             when 'ìƒí™œìš©í’ˆ'
               subcategories = ['ì£¼ë°©ìš©í’ˆ', 'ìš•ì‹¤ìš©í’ˆ', 'ì¸í…Œë¦¬ì–´', 'ìŠ¤í¬ì¸ /í—¬ìŠ¤', 'ì²­ì†Œìš©í’ˆ']
             else
               subcategories = []
             end %>
          
          <% subcategories.each do |subcategory| %>
            <%= link_to products_path(category: @current_category, subcategory: subcategory), 
                        class: "subcategory-link px-4 py-2 rounded-xl transition-all duration-200 #{'bg-purple-600 text-white' if @current_subcategory == subcategory} #{'bg-gray-100 text-gray-700 hover:bg-purple-100 hover:text-purple-700' if @current_subcategory != subcategory}" do %>
              <%= subcategory %>
            <% end %>
          <% end %>
        </div>
        
        <!-- ì„¸ë¶€ í•­ëª© í•„í„° (ì„œë¸Œì¹´í…Œê³ ë¦¬ê°€ ì„ íƒëœ ê²½ìš°ë§Œ í‘œì‹œ) -->
        <% if @current_subcategory.present? %>
          <div class="mt-6">
            <h4 class="text-md font-semibold text-gray-800 mb-3">ì„¸ë¶€ í•­ëª©</h4>
            <div class="flex flex-wrap gap-2" id="detail-filters">
              <%= link_to products_path(category: @current_category, subcategory: @current_subcategory), 
                          class: "detail-link px-3 py-1 text-sm rounded-lg transition-all duration-200 #{'bg-green-500 text-white' unless @current_detail.present?} #{'bg-gray-50 text-gray-600 hover:bg-green-100 hover:text-green-700' if @current_detail.present?}" do %>
                ì „ì²´
              <% end %>
              
              <% case "#{@current_category}-#{@current_subcategory}"
                 when 'ì „ìê¸°ê¸°-íœ´ëŒ€í°'
                   details = ['iPhone', 'ê°¤ëŸ­ì‹œ', 'ì•¡ì„¸ì„œë¦¬']
                 when 'ì „ìê¸°ê¸°-PC/íƒœë¸”ë¦¿'
                   details = ['ë…¸íŠ¸ë¶', 'ë°ìŠ¤í¬í†±', 'íƒœë¸”ë¦¿']
                 when 'ì „ìê¸°ê¸°-ì›¨ì–´ëŸ¬ë¸”'
                   details = ['ìŠ¤ë§ˆíŠ¸ì›Œì¹˜', 'ì´ì–´í°']
                 when 'ì˜ë¥˜-ìƒì˜'
                   details = ['í‹°ì…”ì¸ ', 'ì…”ì¸ ', 'ë‹ˆíŠ¸']
                 when 'ì˜ë¥˜-ì•„ìš°í„°'
                   details = ['ì¬í‚·', 'ì½”íŠ¸', 'íŒ¨ë”©']
                 when 'ì˜ë¥˜-ì¡í™”'
                   details = ['ê°€ë°©', 'ì‹ ë°œ', 'ëª¨ì']
                 when 'ë„ì„œ-ì „ë¬¸ì„œì '
                   details = ['í”„ë¡œê·¸ë˜ë°', 'ë””ìì¸', 'ë¹„ì¦ˆë‹ˆìŠ¤']
                 when 'ìƒí™œìš©í’ˆ-ì£¼ë°©ìš©í’ˆ'
                   details = ['ìš”ë¦¬ë„êµ¬', 'ì‹ê¸°', 'ë³´ê´€ìš©í’ˆ']
                 when 'ìƒí™œìš©í’ˆ-ì¸í…Œë¦¬ì–´'
                   details = ['ì¡°ëª…', 'í–¥ì´ˆ', 'ê¾¸ë¯¸ê¸°']
                 else
                   details = []
                 end %>
              
              <% details.each do |detail| %>
                <%= link_to products_path(category: @current_category, subcategory: @current_subcategory, detail: detail), 
                            class: "detail-link px-3 py-1 text-sm rounded-lg transition-all duration-200 #{'bg-green-500 text-white' if @current_detail == detail} #{'bg-gray-50 text-gray-600 hover:bg-green-100 hover:text-green-700' if @current_detail != detail}" do %>
                  <%= detail %>
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Products Grid -->
  <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
    <% @products.each do |product| %>
      <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover group cursor-pointer" onclick="window.location.href='<%= product_path(product) %>'">
        <div class="relative overflow-hidden">
          <% if product.image_url.present? %>
            <img src="<%= product.image_url %>" alt="<%= product.name %>" class="product-image" style="width: 100%; height: 256px; object-fit: cover; display: block;">
            <div class="w-full h-64 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center" style="display: none;">
              <div class="text-center">
                <svg class="w-12 h-12 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <span class="text-gray-400 text-sm">ì´ë¯¸ì§€ ë¡œë”© ì‹¤íŒ¨</span>
              </div>
            </div>
          <% else %>
            <div class="w-full h-64 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
              <div class="text-center">
                <svg class="w-12 h-12 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <span class="text-gray-400 text-sm">ì´ë¯¸ì§€ ì¤€ë¹„ì¤‘</span>
              </div>
            </div>
          <% end %>
          
          <!-- Category Badge -->
          <div class="absolute top-4 left-4">
            <span class="bg-white bg-opacity-90 text-purple-600 text-xs font-semibold px-3 py-1 rounded-full backdrop-blur-sm">
              <%= product.category %>
            </span>
          </div>
          
          <!-- Hover Overlay -->
          <div class="absolute inset-0 bg-opacity-0 group-hover:bg-opacity-10 transition-all duration-300"></div>
        </div>
        
        <div class="p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-purple-600 transition-colors duration-200">
            <%= product.name %>
          </h3>
          <p class="text-gray-600 text-sm mb-4 line-clamp-2 leading-relaxed">
            <%= truncate(product.description, length: 80) %>
          </p>
          
          <div class="flex items-center justify-between">
            <div class="flex flex-col">
              <span class="text-2xl font-bold text-gray-900">
                â‚©<%= number_with_delimiter(product.price) %>
              </span>
              <span class="text-sm text-gray-500">
                ë¶€ê°€ì„¸ í¬í•¨
              </span>
            </div>
            
            <div class="bg-purple-100 text-purple-600 p-3 rounded-xl group-hover:bg-purple-600 group-hover:text-white transition-all duration-200 transform group-hover:scale-105">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
              </svg>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Empty State -->
  <% if @products.empty? %>
    <div class="text-center py-20">
      <div class="mb-8">
        <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
          </svg>
        </div>
        <h3 class="text-2xl font-semibold text-gray-900 mb-4">ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</h3>
        <p class="text-gray-600 mb-8 max-w-md mx-auto">
          í˜„ì¬ ì„ íƒí•˜ì‹  ì¹´í…Œê³ ë¦¬ì—ëŠ” ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.<br>
          ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ë³´ì„¸ìš”.
        </p>
        <%= link_to root_path, class: "gradient-bg text-white font-semibold py-3 px-6 rounded-xl hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200" do %>
          ì „ì²´ ìƒí’ˆ ë³´ê¸°
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<% else %>
  <!-- ìƒˆë¡œìš´ í™ˆí˜ì´ì§€ ë©”ì¸ ì½˜í…ì¸  -->
  <div class="flex">
    <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
    <div class="flex-1">
      
      <!-- ì „ì²´ ìƒí’ˆ ì„¹ì…˜ -->
      <div class="container mx-auto px-4 lg:px-6 py-8">
        <div class="mb-12">
          <h2 class="text-3xl font-bold text-gray-900 mb-4">ì „ì²´ ìƒí’ˆ</h2>
          <p class="text-gray-600 mb-8">ìµœì‹  ìƒí’ˆë“¤ì„ ë§Œë‚˜ë³´ì„¸ìš”</p>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            <% @all_products.each do |product| %>
              <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover group cursor-pointer" onclick="window.location.href='<%= product_path(product) %>'">
                <div class="relative overflow-hidden">
                  <% if product.image_url.present? %>
                    <img src="<%= product.image_url %>" alt="<%= product.name %>" class="product-image" style="width: 100%; height: 192px; object-fit: cover; display: block;">
                  <% else %>
                    <div class="w-full h-48 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                      <span class="text-gray-400">ì´ë¯¸ì§€ ì¤€ë¹„ì¤‘</span>
                    </div>
                  <% end %>
                  
                  <div class="absolute top-4 left-4">
                    <span class="bg-white bg-opacity-90 text-purple-600 text-xs font-semibold px-3 py-1 rounded-full">
                      <%= product.category %>
                    </span>
                  </div>
                  
                  <!-- Hover Overlay -->
                  <div class="absolute inset-0 bg-opacity-0 group-hover:bg-opacity-10 transition-all duration-300"></div>
                </div>
                
                <div class="p-4">
                  <h3 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-purple-600 transition-colors duration-200">
                    <%= product.name %>
                  </h3>
                  <p class="text-gray-600 text-sm mb-3 line-clamp-2">
                    <%= truncate(product.description, length: 60) %>
                  </p>
                  
                  <div class="flex items-center justify-between">
                    <span class="text-xl font-bold text-gray-900">
                      â‚©<%= number_with_delimiter(product.price) %>
                    </span>
                    <div class="bg-purple-100 text-purple-600 p-2 rounded-lg group-hover:bg-purple-600 group-hover:text-white transition-all duration-200">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
          
          <div class="text-center mt-8">
            <%= link_to products_path(category: ''), class: "gradient-bg text-white font-semibold py-3 px-8 rounded-xl hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200" do %>
              ì „ì²´ ìƒí’ˆ ë³´ê¸°
            <% end %>
          </div>
        </div>
      </div>

      <!-- ê´‘ê³  ë°°ë„ˆ ì„¹ì…˜ -->
      <div class="bg-gradient-to-r from-purple-100 to-blue-100 py-16 mb-12">
        <div class="container mx-auto px-4 lg:px-6">
          <div class="bg-white rounded-3xl shadow-xl overflow-hidden">
            <div class="lg:flex items-center">
              <div class="lg:w-1/2 p-8 lg:p-12">
                <h3 class="text-3xl font-bold text-gray-900 mb-4">íŠ¹ë³„ í• ì¸ ì´ë²¤íŠ¸</h3>
                <p class="text-gray-600 text-lg mb-6">
                  í”„ë¦¬ë¯¸ì—„ ìƒí’ˆë“¤ì„ íŠ¹ë³„í•œ ê°€ê²©ìœ¼ë¡œ ë§Œë‚˜ë³´ì„¸ìš”.<br>
                  ì§€ê¸ˆ êµ¬ë§¤í•˜ì‹œë©´ ìµœëŒ€ 30% í• ì¸ í˜œíƒ!
                </p>
                <div class="flex items-center space-x-4">
                  <span class="bg-red-100 text-red-600 px-4 py-2 rounded-full text-sm font-semibold">
                    ğŸ”¥ í•œì • íŠ¹ê°€
                  </span>
                  <span class="text-gray-500 text-sm">
                    ì´ë²¤íŠ¸ ì¢…ë£Œê¹Œì§€ <span class="font-bold text-red-600">3ì¼</span> ë‚¨ìŒ
                  </span>
                </div>
              </div>
              <div class="lg:w-1/2">
                <div class="h-64 bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center">
                  <div class="text-center text-white">
                    <div class="text-6xl font-bold mb-2">30%</div>
                    <div class="text-xl">í• ì¸</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ì„¹ì…˜ -->
      <div class="container mx-auto px-4 lg:px-6">
        <% @categories.each_with_index do |category, index| %>
          <% products = @products_by_category[category] %>
          <% next if products.empty? %>
          
          <div class="mb-16">
            <div class="flex items-center justify-between mb-8">
              <div>
                <%= link_to products_path(category: category), class: "block hover:text-purple-600 transition-colors duration-200" do %>
                  <h2 class="text-2xl font-bold text-gray-900 mb-2 hover:text-purple-600 transition-colors duration-200">
                    <% case category %>
                    <% when 'ì „ìê¸°ê¸°' %>
                      ğŸ’» ì „ìê¸°ê¸°
                    <% when 'ì˜ë¥˜' %>
                      ğŸ‘” ì˜ë¥˜
                    <% when 'ë„ì„œ' %>
                      ğŸ“š ë„ì„œ
                    <% when 'ìƒí™œìš©í’ˆ' %>
                      ğŸ  ìƒí™œìš©í’ˆ
                    <% end %>
                  </h2>
                <% end %>
                <p class="text-gray-600">
                  <% case category %>
                  <% when 'ì „ìê¸°ê¸°' %>
                    ìµœì‹  ê¸°ìˆ ì˜ ì „ìì œí’ˆë“¤
                  <% when 'ì˜ë¥˜' %>
                    ìŠ¤íƒ€ì¼ë¦¬ì‹œí•œ íŒ¨ì…˜ ì•„ì´í…œë“¤
                  <% when 'ë„ì„œ' %>
                    ì§€ì‹ì„ ë„“í˜€ì£¼ëŠ” ì–‘ì„œë“¤
                  <% when 'ìƒí™œìš©í’ˆ' %>
                    ì¼ìƒì„ í¸ë¦¬í•˜ê²Œ ë§Œë“œëŠ” ì œí’ˆë“¤
                  <% end %>
                </p>
              </div>
              <%= link_to products_path(category: category), class: "text-purple-600 hover:text-purple-800 font-semibold text-sm flex items-center" do %>
                ë” ë³´ê¸°
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                </svg>
              <% end %>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
              <% products.each do |product| %>
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover group cursor-pointer" onclick="window.location.href='<%= product_path(product) %>'">
                  <div class="relative overflow-hidden">
                    <% if product.image_url.present? %>
                      <img src="<%= product.image_url %>" alt="<%= product.name %>" class="product-image" style="width: 100%; height: 192px; object-fit: cover; display: block;">
                    <% else %>
                      <div class="w-full h-48 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                        <span class="text-gray-400">ì´ë¯¸ì§€ ì¤€ë¹„ì¤‘</span>
                      </div>
                    <% end %>
                    
                    <!-- í‰ê·  ë³„ì  í‘œì‹œ -->
                    <% if product.reviews.any? %>
                      <div class="absolute top-4 right-4">
                        <div class="bg-white bg-opacity-90 text-yellow-600 text-xs font-semibold px-2 py-1 rounded-full flex items-center">
                          â­ <%= product.average_rating %>
                        </div>
                      </div>
                    <% end %>
                    
                    <!-- Hover Overlay -->
                    <div class="absolute inset-0 bg-opacity-0 group-hover:bg-opacity-10 transition-all duration-300"></div>
                  </div>
                  
                  <div class="p-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-purple-600 transition-colors duration-200">
                      <%= product.name %>
                    </h3>
                    <p class="text-gray-600 text-sm mb-3 line-clamp-2">
                      <%= truncate(product.description, length: 60) %>
                    </p>
                    
                    <div class="flex items-center justify-between">
                      <span class="text-xl font-bold text-gray-900">
                        â‚©<%= number_with_delimiter(product.price) %>
                      </span>
                      <div class="bg-purple-100 text-purple-600 p-2 rounded-lg group-hover:bg-purple-600 group-hover:text-white transition-all duration-200">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                        </svg>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- ê³ ê° ë¦¬ë·° ì„¹ì…˜ -->
      <div class="bg-gray-50 py-16 mb-12">
        <div class="container mx-auto px-4 lg:px-6">
          <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">ê³ ê° ë¦¬ë·°</h2>
            <p class="text-gray-600">ì‹¤ì œ êµ¬ë§¤ ê³ ê°ë“¤ì˜ ì†”ì§í•œ í›„ê¸°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”</p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <% @recent_reviews.each do |review| %>
              <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                <div class="flex items-start space-x-4">
                  <!-- ìƒí’ˆ ì´ë¯¸ì§€ -->
                  <div class="flex-shrink-0">
                    <% if review.product.image_url.present? %>
                      <%= image_tag review.product.image_url, class: "w-16 h-16 object-cover rounded-lg", alt: review.product.name %>
                    <% else %>
                      <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center">
                        <span class="text-gray-400 text-xs">ì´ë¯¸ì§€</span>
                      </div>
                    <% end %>
                  </div>
                  
                  <div class="flex-1 min-w-0">
                    <!-- ë³„ì  -->
                    <div class="flex items-center mb-2">
                      <% (1..5).each do |i| %>
                        <% if i <= review.rating %>
                          <span class="text-yellow-400">â­</span>
                        <% else %>
                          <span class="text-gray-300">â­</span>
                        <% end %>
                      <% end %>
                      <span class="ml-2 text-sm text-gray-600">(<%= review.rating %>/5)</span>
                    </div>
                    
                    <!-- ë¦¬ë·° ë‚´ìš© -->
                    <p class="text-gray-700 text-sm leading-relaxed mb-4 line-clamp-3">
                      <%= review.content %>
                    </p>
                    
                    <!-- ì‚¬ìš©ì ì •ë³´ -->
                    <div class="flex items-center justify-between text-xs text-gray-500">
                      <span><%= review.masked_user_id %></span>
                      <span><%= review.created_at.strftime('%Y.%m.%d') %></span>
                    </div>
                    
                    <!-- ìƒí’ˆëª… -->
                    <div class="mt-2">
                      <%= link_to product_path(review.product), class: "text-purple-600 hover:text-purple-800 text-sm font-medium" do %>
                        <%= review.product.name %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
          
          <% if @recent_reviews.empty? %>
            <div class="text-center py-12">
              <div class="text-gray-400 mb-4">
                <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10m0 0V6a2 2 0 00-2-2H9a2 2 0 00-2 2v2m10 0v10a2 2 0 01-2 2H9a2 2 0 01-2-2V8m10 0H7"/>
                </svg>
              </div>
              <p class="text-gray-500">ì•„ì§ ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- ìµœê·¼ ë³¸ ìƒí’ˆ ì‚¬ì´ë“œë°” (ê³ ì •) - ë¡œê·¸ì¸í•œ ì‚¬ìš©ì & ë°ìŠ¤í¬íƒ‘ë§Œ í‘œì‹œ -->
    <% if user_signed_in? %>
      <div class="fixed right-4 w-56 z-30 hidden lg:block" id="recent-products-sidebar" style="top: 420px;">
        <div class="bg-white rounded-xl shadow-xl overflow-hidden max-h-[70vh]">
        <div class="bg-gradient-to-r from-purple-600 to-blue-600 p-3">
          <h3 class="text-white font-medium text-sm">ìµœê·¼ ë³¸ ìƒí’ˆ</h3>
        </div>
        
        <div class="overflow-y-auto max-h-96" id="recent-products-list">
          <% if user_signed_in? && @recently_viewed_products&.any? %>
            <% @recently_viewed_products.each do |product| %>
              <div class="flex items-center p-3 hover:bg-gray-50 transition-colors duration-200">
                <%= link_to product_path(product), class: "flex items-center space-x-3 w-full" do %>
                  <% if product.image_url.present? %>
                    <%= image_tag product.image_url, class: "w-12 h-12 object-cover rounded-lg flex-shrink-0", alt: product.name %>
                  <% else %>
                    <div class="w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center flex-shrink-0">
                      <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                      </svg>
                    </div>
                  <% end %>
                  
                  <div class="flex-1 min-w-0">
                    <h4 class="text-sm font-medium text-gray-900 truncate"><%= product.name %></h4>
                    <p class="text-xs text-purple-600 font-semibold">â‚©<%= number_with_delimiter(product.price) %></p>
                  </div>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <div class="p-6 text-center text-gray-500">
              <svg class="w-12 h-12 mx-auto mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              </svg>
              <% if user_signed_in? %>
                <p class="text-sm">ìµœê·¼ ë³¸ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</p>
                <p class="text-xs mt-1">ìƒí’ˆì„ ë‘˜ëŸ¬ë³´ì„¸ìš”!</p>
              <% else %>
                <p class="text-sm">ë¡œê·¸ì¸í•˜ë©´</p>
                <p class="text-xs mt-1">ìµœê·¼ ë³¸ ìƒí’ˆì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
              <% end %>
            </div>
          <% end %>
        </div>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

<!-- Newsletter Section -->
<div class="bg-gray-50 py-16">
  <div class="container mx-auto px-4 lg:px-6">
    <div class="text-center max-w-2xl mx-auto">
      <h3 class="text-3xl font-bold text-gray-900 mb-4">ìƒˆë¡œìš´ ì†Œì‹ì„ ë°›ì•„ë³´ì„¸ìš”</h3>
      <p class="text-gray-600 mb-8">
        ì‹ ì œí’ˆ ì¶œì‹œ ì†Œì‹ê³¼ íŠ¹ë³„í•œ í• ì¸ í˜œíƒì„ ê°€ì¥ ë¨¼ì € ë°›ì•„ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
      <div class="flex flex-col sm:flex-row max-w-md mx-auto space-y-4 sm:space-y-0 sm:space-x-4">
        <input type="email" placeholder="ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
               class="flex-1 px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
        <button class="gradient-bg text-white font-semibold py-3 px-6 rounded-xl hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200">
          êµ¬ë…í•˜ê¸°
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  /* ìƒí’ˆ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
  .product-image {
    width: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.3s ease;
  }
  
  .card-hover:hover .product-image {
    transform: scale(1.05);
  }
  
  
  /* ìŠ¬ë¼ì´ë” ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  .slider-prev-btn {
    cursor: pointer;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    left: 0;
    z-index: 1;
    width: 102px;
    height: 102px;
    background: url(/ux/imgs/web/display/main_slider_prev@3x.png) center no-repeat;
    background-size: 102px;
    border: none;
    opacity: 0.8;
    transition: opacity 0.3s ease;
  }
  
  .slider-next-btn {
    cursor: pointer;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    right: 0;
    z-index: 1;
    width: 102px;
    height: 102px;
    background: url(/ux/imgs/web/display/main_slider_next@3x.png) center no-repeat;
    background-size: 102px;
    border: none;
    opacity: 0.8;
    transition: opacity 0.3s ease;
  }
  
  .slider-prev-btn:hover,
  .slider-next-btn:hover {
    opacity: 1;
  }
</style>

<script>
  function filterByCategory(category) {
    // ë¡œë”© ìƒíƒœ í‘œì‹œ
    const select = document.getElementById('category-select');
    const submitBtn = document.getElementById('filter-submit');
    const originalText = submitBtn.textContent;
    
    select.disabled = true;
    submitBtn.disabled = true;
    submitBtn.textContent = 'í•„í„°ë§ ì¤‘...';
    
    // í˜„ì¬ URLì— ì¹´í…Œê³ ë¦¬ íŒŒë¼ë¯¸í„° ì¶”ê°€/ìˆ˜ì •
    const url = new URL(window.location);
    if (category === '') {
      url.searchParams.delete('category');
    } else {
      url.searchParams.set('category', category);
    }
    
    // í˜ì´ì§€ ì´ë™
    window.location.href = url.toString();
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„ íƒëœ ì¹´í…Œê³ ë¦¬ í‘œì‹œ ê°œì„ 
  document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const category = urlParams.get('category');
    const select = document.getElementById('category-select');
    
    if (category && select) {
      select.value = category;
    }
    
    // í˜„ì¬ ì„ íƒëœ ì¹´í…Œê³ ë¦¬ í•˜ì´ë¼ì´íŠ¸
    if (category) {
      const selectedOption = select.querySelector(`option[value="${category}"]`);
      if (selectedOption) {
        select.classList.add('border-purple-500', 'ring-2', 'ring-purple-200');
      }
    }
    
    // ìµœê·¼ ë³¸ ìƒí’ˆ ë¡œë“œ (í™ˆí˜ì´ì§€ì—ì„œë§Œ)
    <% unless @show_category_view %>
      loadRecentProducts();
    <% end %>
  });

  // ìµœê·¼ ë³¸ ìƒí’ˆ ê´€ë¦¬
  function getRecentProducts() {
    const recent = localStorage.getItem('recentProducts');
    return recent ? JSON.parse(recent) : [];
  }

  function addToRecentProducts(product) {
    let recent = getRecentProducts();
    
    // ì´ë¯¸ ì¡´ì¬í•˜ë©´ ì œê±°
    recent = recent.filter(p => p.id !== product.id);
    
    // ë§¨ ì•ì— ì¶”ê°€
    recent.unshift(product);
    
    // ìµœëŒ€ 10ê°œë§Œ ìœ ì§€
    recent = recent.slice(0, 10);
    
    localStorage.setItem('recentProducts', JSON.stringify(recent));
    updateRecentProductsDisplay();
  }

  function loadRecentProducts() {
    updateRecentProductsDisplay();
  }

  function updateRecentProductsDisplay() {
    const recentProductsList = document.getElementById('recent-products-list');
    if (!recentProductsList) return;
    
    const recent = getRecentProducts();
    
    if (recent.length === 0) {
      recentProductsList.innerHTML = `
        <div class="p-6 text-center text-gray-500">
          <svg class="w-12 h-12 mx-auto mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
          </svg>
          <p class="text-sm">ìµœê·¼ ë³¸ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</p>
        </div>
      `;
      return;
    }
    
    const html = recent.map(product => `
      <div class="border-b border-gray-100 last:border-b-0">
        <a href="/products/${product.id}" class="block p-4 hover:bg-gray-50 transition-colors duration-200">
          <div class="flex items-center space-x-3">
            <div class="flex-shrink-0">
              <img src="${product.image_url || '/placeholder-image.jpg'}" alt="${product.name}" class="w-12 h-12 object-cover rounded-lg" onerror="this.src='/placeholder-image.jpg';">
            </div>
            <div class="flex-1 min-w-0">
              <h4 class="text-sm font-medium text-gray-900 truncate">${product.name}</h4>
              <p class="text-xs text-gray-500 truncate">${product.category}</p>
              <p class="text-sm font-semibold text-purple-600 mt-1">â‚©${product.price.toLocaleString()}</p>
            </div>
          </div>
        </a>
      </div>
    `).join('');
    
    recentProductsList.innerHTML = html;
  }

  // ìƒí’ˆ í˜ì´ì§€ì—ì„œ í˜¸ì¶œë  í•¨ìˆ˜ (ì „ì—­ í•¨ìˆ˜)
  window.addProductToRecent = function(productData) {
    addToRecentProducts(productData);
  };

  // ìŠ¬ë¼ì´ë“œ ê¸°ëŠ¥ (í™ˆí˜ì´ì§€ì—ì„œë§Œ)
  <% unless @show_category_view %>
    let currentSlide = 0;
    const totalSlides = 4;
    let slideInterval;

    function showSlide(index) {
      const container = document.getElementById('slider-container');
      const indicators = document.querySelectorAll('[id^="indicator-"]');
      
      if (container) {
        container.style.transform = `translateX(-${index * 100}%)`;
        
        // ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸
        indicators.forEach((indicator, i) => {
          if (i === index) {
            indicator.classList.add('bg-white', 'bg-opacity-100');
            indicator.classList.remove('bg-opacity-50');
          } else {
            indicator.classList.add('bg-opacity-50');
            indicator.classList.remove('bg-white', 'bg-opacity-100');
          }
        });
      }
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % totalSlides;
      showSlide(currentSlide);
      resetAutoSlide();
    }

    function prevSlide() {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      showSlide(currentSlide);
      resetAutoSlide();
    }

    function goToSlide(index) {
      currentSlide = index;
      showSlide(currentSlide);
      resetAutoSlide();
    }

    function startAutoSlide() {
      slideInterval = setInterval(() => {
        nextSlide();
      }, 5000); // 5ì´ˆë§ˆë‹¤ ìë™ ì „í™˜
    }

    function resetAutoSlide() {
      clearInterval(slideInterval);
      startAutoSlide();
    }

    function pauseAutoSlide() {
      clearInterval(slideInterval);
    }

    // ìŠ¬ë¼ì´ë”ì— ë§ˆìš°ìŠ¤ í˜¸ë²„ ì‹œ ìë™ ì „í™˜ ì¼ì‹œì •ì§€
    document.addEventListener('DOMContentLoaded', function() {
      const slider = document.getElementById('hero-slider');
      if (slider) {
        showSlide(0); // ì²« ë²ˆì§¸ ìŠ¬ë¼ì´ë“œ í‘œì‹œ
        startAutoSlide(); // ìë™ ì „í™˜ ì‹œì‘
        
        slider.addEventListener('mouseenter', pauseAutoSlide);
        slider.addEventListener('mouseleave', startAutoSlide);
      }
    });

    // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (ë²„íŠ¼ onclickì—ì„œ ì‚¬ìš©)
    window.nextSlide = nextSlide;
    window.prevSlide = prevSlide;
    window.goToSlide = goToSlide;

  <% end %>
  
  // ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ íƒ­ ë™ì  ë¡œë”© ì‹œìŠ¤í…œ (í™ˆí˜ì´ì§€ì™€ ì¹´í…Œê³ ë¦¬ í˜ì´ì§€ ëª¨ë‘ì—ì„œ ì‚¬ìš©)
  function loadSubcategoryContent(category, subcategory = '', detail = '') {
    // ë¡œë”© í‘œì‹œ
    const productsGrid = document.getElementById('products-grid');
    const productCount = document.getElementById('product-count');
    
    if (productsGrid) {
      productsGrid.innerHTML = '<div class="col-span-full text-center py-8"><div class="text-gray-500">ë¡œë”© ì¤‘...</div></div>';
    }
    
    // URL ìƒì„±
    let url = '<%= products_path %>?category=' + encodeURIComponent(category);
    if (subcategory) url += '&subcategory=' + encodeURIComponent(subcategory);
    if (detail) url += '&detail=' + encodeURIComponent(detail);
    
    // AJAX ìš”ì²­
    fetch(url, {
      headers: {
        'Accept': 'text/html',
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
    .then(response => response.text())
    .then(html => {
      // ìƒˆ í˜ì´ì§€ì—ì„œ ìƒí’ˆ ê·¸ë¦¬ë“œì™€ ê°œìˆ˜ ì¶”ì¶œ
      const parser = new DOMParser();
      const newDoc = parser.parseFromString(html, 'text/html');
      
      const newProductsGrid = newDoc.querySelector('#products-grid');
      const newProductCount = newDoc.querySelector('#product-count');
      
      // í˜„ì¬ í˜ì´ì§€ ì—…ë°ì´íŠ¸
      if (productsGrid && newProductsGrid) {
        productsGrid.innerHTML = newProductsGrid.innerHTML;
      }
      if (productCount && newProductCount) {
        productCount.textContent = newProductCount.textContent;
      }
      
      // ì„¸ë¶€ í•­ëª© í•„í„°ë„ ì—…ë°ì´íŠ¸
      const detailFilters = document.getElementById('detail-filters');
      const newDetailFilters = newDoc.querySelector('#detail-filters');
      if (detailFilters && newDetailFilters) {
        detailFilters.parentElement.innerHTML = newDetailFilters.parentElement.innerHTML;
      } else if (detailFilters && !newDetailFilters) {
        detailFilters.parentElement.style.display = 'none';
      }
      
      // URL ì—…ë°ì´íŠ¸ (ë¸Œë¼ìš°ì € íˆìŠ¤í† ë¦¬)
      history.pushState(null, '', url);
    })
    .catch(error => {
      console.error('Failed to load subcategory content:', error);
      if (productsGrid) {
        productsGrid.innerHTML = '<div class="col-span-full text-center py-8"><div class="text-red-500">ë¡œë”© ì‹¤íŒ¨</div></div>';
      }
    });
  }

  // ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ ë§í¬ í´ë¦­ ì´ë²¤íŠ¸
  document.addEventListener('click', function(e) {
    const subcategoryLink = e.target.closest('.subcategory-link');
    
    if (subcategoryLink) {
      e.preventDefault(); // ê¸°ë³¸ ë§í¬ ë™ì‘ ë°©ì§€
      
      const href = subcategoryLink.getAttribute('href');
      const url = new URL(href, window.location.origin);
      const category = url.searchParams.get('category');
      const subcategory = url.searchParams.get('subcategory') || '';
      
      // ë™ì  ë¡œë”©
      loadSubcategoryContent(category, subcategory);
      
      // íƒ­ ìƒíƒœ ì—…ë°ì´íŠ¸
      updateTabStates(category, subcategory);
    }
  });

  // ì„¸ë¶€ í•­ëª© ë§í¬ í´ë¦­ ì´ë²¤íŠ¸
  document.addEventListener('click', function(e) {
    const detailLink = e.target.closest('.detail-link');
    
    if (detailLink) {
      e.preventDefault();
      
      const href = detailLink.getAttribute('href');
      const url = new URL(href, window.location.origin);
      const category = url.searchParams.get('category');
      const subcategory = url.searchParams.get('subcategory') || '';
      const detail = url.searchParams.get('detail') || '';
      
      console.log('Detail tab clicked:', category, subcategory, detail);
      
      // ë™ì  ë¡œë”©
      loadSubcategoryContent(category, subcategory, detail);
      
      // íƒ­ ìƒíƒœ ì—…ë°ì´íŠ¸
      updateTabStates(category, subcategory, detail);
    }
  });

  // íƒ­ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
  function updateTabStates(category, subcategory = '', detail = '') {
    // ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ íƒ­ ìƒíƒœ ì—…ë°ì´íŠ¸
    document.querySelectorAll('.subcategory-link').forEach(link => {
      const href = link.getAttribute('href');
      const url = new URL(href, window.location.origin);
      const linkSubcategory = url.searchParams.get('subcategory') || '';
      
      // í™œì„± ìƒíƒœ í´ë˜ìŠ¤ í† ê¸€
      if (linkSubcategory === subcategory) {
        link.className = link.className.replace(/bg-gray-100.*?hover:text-purple-700/, 'bg-purple-600 text-white');
      } else {
        link.className = link.className.replace(/bg-purple-600 text-white/, 'bg-gray-100 text-gray-700 hover:bg-purple-100 hover:text-purple-700');
      }
    });

    // ì„¸ë¶€ í•­ëª© íƒ­ ìƒíƒœ ì—…ë°ì´íŠ¸
    document.querySelectorAll('.detail-link').forEach(link => {
      const href = link.getAttribute('href');
      const url = new URL(href, window.location.origin);
      const linkDetail = url.searchParams.get('detail') || '';
      
      if (linkDetail === detail) {
        link.className = link.className.replace(/bg-gray-50.*?hover:text-green-700/, 'bg-green-500 text-white');
      } else {
        link.className = link.className.replace(/bg-green-500 text-white/, 'bg-gray-50 text-gray-600 hover:bg-green-100 hover:text-green-700');
      }
    });
  }
</script>
